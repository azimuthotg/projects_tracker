{% comment %}
Budget progress bar component.
Usage: {% include "components/_budget_bar.html" with percent=activity.budget_usage_percent spent=activity.total_spent allocated=activity.allocated_budget %}
{% endcomment %}
<div class="group relative">
    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
        {% if percent < 60 %}
        <div class="budget-bar-fill bg-gradient-to-r from-green-400 to-green-500 h-3 rounded-full shadow-sm"
             style="width: {{ percent|floatformat:0 }}%"></div>
        {% elif percent < 80 %}
        <div class="budget-bar-fill bg-gradient-to-r from-yellow-400 to-yellow-500 h-3 rounded-full shadow-sm"
             style="width: {{ percent|floatformat:0 }}%"></div>
        {% else %}
        <div class="budget-bar-fill bg-gradient-to-r from-red-400 to-red-500 h-3 rounded-full shadow-sm"
             style="width: {% if percent > 100 %}100{% else %}{{ percent|floatformat:0 }}{% endif %}%"></div>
        {% endif %}
    </div>
    <div class="flex items-center justify-between mt-1">
        <span class="text-xs font-semibold
            {% if percent < 60 %}text-green-600
            {% elif percent < 80 %}text-yellow-600
            {% else %}text-red-600{% endif %}">
            {{ percent|floatformat:1 }}%
        </span>
        {% if spent and allocated %}
        <span class="text-xs text-gray-400 hidden group-hover:inline">{{ spent|floatformat:0 }} / {{ allocated|floatformat:0 }}</span>
        {% endif %}
    </div>

    {% comment %} Tooltip shown on parent hover via JS — see base.html style {% endcomment %}
    {% if spent and allocated %}
    <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-10 pointer-events-none">
        <div class="bg-gray-800 text-white text-xs rounded-lg px-3 py-2 whitespace-nowrap shadow-xl">
            <div class="flex gap-3">
                <span>ใช้ไป <strong>{{ spent|floatformat:2 }}</strong></span>
                <span class="text-gray-400">|</span>
                <span>คงเหลือ <strong
                    {% if percent >= 80 %}class="text-red-300"{% else %}class="text-green-300"{% endif %}>
                    {% if allocated and spent %}{{ allocated|floatformat:2 }}{% endif %}
                </strong></span>
            </div>
        </div>
        <div class="w-2 h-2 bg-gray-800 rotate-45 mx-auto -mt-1"></div>
    </div>
    {% endif %}
</div>
