{% extends "base.html" %}

{% block title %}{% if is_edit %}แก้ไขผู้ใช้ {{ target_user.username }}{% else %}เพิ่มผู้ใช้ใหม่{% endif %}{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{% url 'accounts:user_list' %}" class="text-blue-600 hover:text-blue-800 text-sm">&larr; กลับไปรายการผู้ใช้</a>
    <h1 class="text-2xl font-bold text-gray-800 mt-2">{% if is_edit %}แก้ไขผู้ใช้: {{ target_user.username }}{% else %}เพิ่มผู้ใช้ใหม่{% endif %}</h1>
</div>

<div class="grid grid-cols-1 lg:grid-cols-{% if is_edit %}2{% else %}1{% endif %} gap-6">
    <!-- User Info Form -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">{% if is_edit %}ข้อมูลผู้ใช้{% else %}กรอกข้อมูลผู้ใช้{% endif %}</h2>
        <form method="post">
            {% csrf_token %}
            {% for field in form %}
            {% include "components/_form_field.html" with field=field %}
            {% endfor %}
            <div class="flex items-center space-x-3 mt-6">
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
                    {% if is_edit %}บันทึกการแก้ไข{% else %}สร้างผู้ใช้{% endif %}
                </button>
                <a href="{% url 'accounts:user_list' %}" class="px-6 py-2 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 transition-colors">ยกเลิก</a>
            </div>
        </form>
    </div>

    {% if is_edit %}
    <!-- Password Reset Form -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">รีเซ็ตรหัสผ่าน</h2>
        {% if target_user.profile and target_user.profile.source == 'npu_api' %}
        <div class="p-4 bg-amber-50 border border-amber-200 rounded-lg mb-4">
            <p class="text-sm text-amber-800 font-medium">ผู้ใช้นี้เข้าสู่ระบบผ่าน NPU AD</p>
            <p class="text-sm text-amber-700 mt-1">หากกำหนดรหัสผ่านใหม่ ผู้ใช้จะเปลี่ยนเป็น Local User และใช้รหัสผ่านที่ตั้งไว้แทน AD</p>
        </div>
        {% else %}
        <p class="text-sm text-gray-500 mb-4">กำหนดรหัสผ่านใหม่ให้ผู้ใช้ {{ target_user.username }}</p>
        {% endif %}
        <form method="post">
            {% csrf_token %}
            {% for field in pw_form %}
            {% include "components/_form_field.html" with field=field %}
            {% endfor %}
            <button type="submit" name="reset_password" value="1" class="mt-4 px-6 py-2 bg-yellow-500 text-white text-sm font-medium rounded-lg hover:bg-yellow-600 transition-colors"
                {% if target_user.profile and target_user.profile.source == 'npu_api' %}onclick="return confirm('ยืนยันเปลี่ยนเป็น Local User? ผู้ใช้จะไม่ใช้รหัสผ่าน AD อีกต่อไป')"{% endif %}>
                รีเซ็ตรหัสผ่าน
            </button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
